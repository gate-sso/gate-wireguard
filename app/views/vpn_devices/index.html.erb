<p style="color: green"><%= notice %></p>

<% if @user_devices_only %>
  <h4>My VPN Devices</h4>
  <p class="text-muted">These are your personal VPN devices. You can download configurations and manage your own devices here.</p>
<% else %>
  <h4>VPN Devices <%= @nodes ? "(Nodes)" : "(All)" %></h4>
  <% if current_user&.admin? %>
    <p class="text-muted">All VPN devices in the system. As an administrator, you can manage all devices.</p>
  <% end %>
<% end %>

<div id="vpn_devices">
  <% if @vpn_devices.any? %>
    <table class="table table-striped table-hover table-dynamic">
      <thead class="thead-dynamic">
      <tr>
        <% unless @user_devices_only %>
          <th>User</th>
        <% end %>
        <th>Device description</th>
        <th colspan="2"></th>
      </tr>
      </thead>

      <tbody>
      <% @vpn_devices.each do |vpn_device| %>
        <tr>
          <% unless @user_devices_only %>
            <td><%= vpn_device.user.name %></td>
          <% end %>
          <td><%= vpn_device.description %></td>

          <% if @user_devices_only || current_user&.admin? %>
            <td><%= link_to 'Remove Device', vpn_device, data: { turbo_method: :delete, turbo_confirm: 'Are you sure?' }, class: 'btn btn-danger btn-sm' %></td>
            <td><%= link_to 'Show Device', vpn_device, data: { turbo_method: :get }, class: 'btn btn-primary btn-sm' %></td>
          <% else %>
            <td colspan="2" class="text-muted">View only</td>
          <% end %>
        </tr>
      <% end %>
      </tbody>
    </table>
  <% else %>
    <div class="text-center py-5">
      <i class="bi bi-router display-1 text-muted"></i>
      <h5 class="mt-3 text-muted">
        <% if @user_devices_only %>
          No VPN devices found
        <% else %>
          No devices in the system
        <% end %>
      </h5>
      <p class="text-muted">
        <% if @user_devices_only %>
          You haven't created any VPN devices yet. Create your first device to get started.
        <% else %>
          No VPN devices have been created in the system yet.
        <% end %>
      </p>
      <% if @user_devices_only %>
        <%= link_to 'Create Your First Device', new_vpn_device_path, class: 'btn btn-primary' %>
      <% end %>
    </div>
  <% end %>
  
  <% if @user_devices_only && @vpn_devices.any? %>
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <%= link_to 'Add New Device', new_vpn_device_path, class: 'btn btn-primary' %>
      </div>
      <div>
        <small class="text-muted">You can create and manage your VPN devices here.</small>
      </div>
    </div>
  <% end %>
  <br>
</div>