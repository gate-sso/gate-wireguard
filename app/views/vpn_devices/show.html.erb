<div class="container-fluid" data-controller="clipboard">
  <div class="row justify-content-center">
    <div class="col-lg-10 col-xl-8">

      <div class="page-header">
        <div>
          <h3>VPN Device Configuration</h3>
          <div class="page-header-subtitle">Secure network access configuration</div>
        </div>
        <%= link_to vpn_devices_path, class: "btn btn-outline-secondary btn-sm" do %>
          <i class="bi bi-arrow-left"></i> Back to Devices
        <% end %>
      </div>

      <% if alert %>
        <div class="alert alert-danger"><i class="bi bi-exclamation-triangle-fill me-2"></i><%= alert %></div>
      <% end %>
      <% if notice %>
        <div class="alert alert-success"><i class="bi bi-check-circle-fill me-2"></i><%= notice %></div>
      <% end %>

      <% if @vpn_device.description? %>
        <div class="card mb-4">
          <div class="card-header d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center gap-3">
              <div>
                <h5 class="mb-0"><%= @vpn_device.description %></h5>
                <small class="text-muted">Device Configuration</small>
              </div>
            </div>
            <span class="badge bg-success">Active</span>
          </div>

          <div class="card-body p-4">
            <div class="row g-4">

              <div class="col-lg-8">
                <div class="config-row">
                  <div class="config-label">
                    <i class="bi bi-server text-primary"></i> VPN Server IP
                  </div>
                  <div class="config-value">
                    <code><%= @vpn_configuration.wg_ip_address %></code>
                    <button class="btn btn-sm btn-outline-secondary copy-btn"
                            data-clipboard-target="button"
                            data-action="click->clipboard#copy"
                            data-clipboard-text-param="<%= @vpn_configuration.wg_ip_address %>">
                      <i class="bi bi-copy"></i>
                    </button>
                  </div>
                </div>

                <div class="config-row">
                  <div class="config-label">
                    <i class="bi bi-key-fill text-warning"></i> Private Key
                  </div>
                  <div class="config-value">
                    <code class="font-mono" style="font-size: 0.75rem; word-break: break-all;"><%= @vpn_device.private_key %></code>
                    <button class="btn btn-sm btn-outline-secondary copy-btn"
                            data-clipboard-target="button"
                            data-action="click->clipboard#copy"
                            data-clipboard-text-param="<%= @vpn_device.private_key %>">
                      <i class="bi bi-copy"></i>
                    </button>
                  </div>
                </div>

                <div class="config-row">
                  <div class="config-label">
                    <i class="bi bi-shield-check text-success"></i> Public Key
                  </div>
                  <div class="config-value">
                    <code class="font-mono" style="font-size: 0.75rem; word-break: break-all;"><%= @vpn_device.public_key %></code>
                    <button class="btn btn-sm btn-outline-secondary copy-btn"
                            data-clipboard-target="button"
                            data-action="click->clipboard#copy"
                            data-clipboard-text-param="<%= @vpn_device.public_key %>">
                      <i class="bi bi-copy"></i>
                    </button>
                  </div>
                </div>

                <div class="config-row">
                  <div class="config-label">
                    <i class="bi bi-router-fill text-info"></i> Device IP
                  </div>
                  <div class="config-value">
                    <code><%= @vpn_device.ip_allocation.ip_address %></code>
                    <button class="btn btn-sm btn-outline-secondary copy-btn"
                            data-clipboard-target="button"
                            data-action="click->clipboard#copy"
                            data-clipboard-text-param="<%= @vpn_device.ip_allocation.ip_address %>">
                      <i class="bi bi-copy"></i>
                    </button>
                  </div>
                </div>

                <div class="config-row">
                  <div class="config-label">
                    <i class="bi bi-diagram-3 text-secondary"></i> Remote Networks
                  </div>
                  <div class="config-value">
                    <div class="d-flex flex-wrap gap-1">
                      <% @vpn_configuration.network_addresses.each do |network| %>
                        <span class="badge bg-secondary bg-opacity-10 text-secondary border"><%= network.network_address %></span>
                      <% end %>
                    </div>
                  </div>
                </div>

                <div class="mt-4 d-flex gap-2 flex-wrap">
                  <%= link_to download_config_path(@vpn_device.id), class: "btn btn-primary" do %>
                    <i class="bi bi-download"></i> Download Configuration
                  <% end %>
                  <%= link_to @vpn_device, method: :delete, data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to remove this device?" }, class: "btn btn-outline-danger" do %>
                    <i class="bi bi-trash3"></i> Remove Device
                  <% end %>
                </div>
              </div>

              <div class="col-lg-4">
                <div class="text-center">
                  <div class="qr-container">
                    <%= raw @vpn_device.generate_qr_code %>
                  </div>
                  <div class="mt-3">
                    <h6 class="fw-semibold mb-1">Quick Setup</h6>
                    <p class="text-muted small mb-0">Scan with WireGuard app</p>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
